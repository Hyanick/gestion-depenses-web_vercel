<div class="budget container">

    <!-- Solde -->
    <div class="balance-hero">
        <div>
            <div class="label">Solde du mois</div>
            <div class="balance" [class.negative]="balance < 0" [class.positive]="balance >= 0">
                {{ balance | number:'1.0-2' }} €
            </div>
        </div>

        <!-- Bouton + (pour l’instant ajoute une dépense mock) -->
        <button mat-fab class="fab" (click)="openAddExpense()">
            <mat-icon>add</mat-icon>
        </button>
    </div>

    <!-- REVENUS -->
    <div class="card section">
        <div class="section-head">
            <div>
                <div class="title">Total revenus du mois :</div>
                <div class="total positive">{{ totalIncome | number:'1.0-2' }} €</div>
            </div>
<!-- 
            <button mat-stroked-button class="mini" (click)="addIncome()">
                <mat-icon>add</mat-icon>
                Revenu
            </button> -->
        </div>

        <div class="list card-inner">
            <div class="row ios-row" *ngFor="let it of incomes">
                <div class="left">
                    <div class="squircle" [style.background]="it.color + '18'">
                        <mat-icon [style.color]="it.color">{{ it.icon }}</mat-icon>
                    </div>

                    <div class="meta">
                        <div class="cat">{{ it.category }}</div>
                        <div class="desc muted">{{ it.label }}</div>
                    </div>
                </div>

                <div class="right">
                    <div class="amount" (click)="startEdit(it.id)">
                        <ng-container *ngIf="editingId !== it.id; else editIncome">
                            <span class="value">{{ it.amount | number:'1.0-2' }} €</span>
                        </ng-container>

                        <ng-template #editIncome>
                            <input class="amount-input" type="number" [(ngModel)]="it.amount" (blur)="stopEdit()"
                                (keydown.enter)="stopEdit()" autofocus />
                            <span class="eur">€</span>
                        </ng-template>
                    </div>

                    <button mat-icon-button class="kebab" [matMenuTriggerFor]="menuIncome"
                        (click)="$event.stopPropagation()">
                        <mat-icon>more_horiz</mat-icon>
                    </button>

                    <mat-menu #menuIncome="matMenu">
                        <button mat-menu-item (click)="startEdit(it.id)">
                            <mat-icon>edit</mat-icon>
                            <span>Modifier</span>
                        </button>
                        <button mat-menu-item (click)="remove(it.id)">
                            <mat-icon>delete</mat-icon>
                            <span>Supprimer</span>
                        </button>
                    </mat-menu>
                </div>
            </div>
        </div>
    </div>

    <!-- DEPENSES -->
    <div class="card section">
        <div class="section-head">
            <div>
                <div class="title">Total des dépenses du mois :</div>
                <div class="total negative">{{ totalExpense | number:'1.0-2' }} €</div>
            </div>

            <!-- <button mat-stroked-button class="mini" (click)="addExpense()">
                <mat-icon>add</mat-icon>
                Dépense
            </button> -->
        </div>

        <div class="list card-inner">
            <div class="row ios-row" *ngFor="let it of expenses">
                <div class="left">
                    <div class="squircle" [style.background]="it.color + '18'">
                        <mat-icon [style.color]="it.color">{{ it.icon }}</mat-icon>
                    </div>

                    <div class="meta">
                        <div class="cat">{{ it.category }}</div>
                        <div class="desc muted">{{ it.label }}</div>
                    </div>
                </div>

                <div class="right">
                    <div class="amount" (click)="startEdit(it.id)">
                        <ng-container *ngIf="editingId !== it.id; else editExpense">
                            <span class="value">{{ it.amount | number:'1.0-2' }} €</span>
                        </ng-container>

                        <ng-template #editExpense>
                            <input class="amount-input" type="number" [(ngModel)]="it.amount" (blur)="stopEdit()"
                                (keydown.enter)="stopEdit()" autofocus />
                            <span class="eur">€</span>
                        </ng-template>
                    </div>

                    <button mat-icon-button class="kebab" [matMenuTriggerFor]="menuExpense"
                        (click)="$event.stopPropagation()">
                        <mat-icon>more_horiz</mat-icon>
                    </button>

                    <mat-menu #menuExpense="matMenu">
                        <button mat-menu-item (click)="startEdit(it.id)">
                            <mat-icon>edit</mat-icon>
                            <span>Modifier</span>
                        </button>
                        <button mat-menu-item (click)="remove(it.id)">
                            <mat-icon>delete</mat-icon>
                            <span>Supprimer</span>
                        </button>
                    </mat-menu>
                </div>
            </div>
        </div>
    </div>

</div>